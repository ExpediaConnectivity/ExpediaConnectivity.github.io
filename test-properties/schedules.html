<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Schedules - APIs for Expedia Partners</title><meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Expedia Connectivity</title>

<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/foundation.min.css">
<link rel="stylesheet" href="/css/code/styles/github-gist.css">
<link rel="stylesheet" href="/css/styles.css">

<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="/css/he-animate.css">

<script src="/js/jquery.js"></script>
<script src="/js/vendor/modernizr.js"></script>
<script src="/js/highlight.pack.js"></script>
<script src="/js/foundation.min.js"></script>
<script src="/js/Core.js"></script>
<script src="/js/he-main.js"></script>
<script src="/js/he-plugins.js"></script>
<script src="/js/he-smoothscroll.js"></script>
<script src="/js/he-waypoints.js"></script>
<script src="/js/environment.js"></script>
<script>
    $(document).ready(function() {
        $('.api-content pre>code').each(function(i, block) {
            hljs.highlightBlock(block);
        });
        Core.init();
    });

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-79394707-1', 'auto');
    ga('send', 'pageview');
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.FloatPosition.TOP_LEFT, gaTrack: true, gaId: 'UA-79394707-1'}, 'google_translate_element');
    }
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head><body id="page-index" class="he-active_now he-animate he-fade_in no-js"><div id="google_translate_element" style="display: none;"></div>
<header id="site-navigation">
    <nav id="nav-top" class="row full-width">
        <div class="inner">
            <ul>
                <li id="hotelnav" style="display:none"><a href="/test-properties/schedules">Schedules</a></li>
                <li id="logoutnav" style="display:none"><a href="/test-properties/" onclick="logout();">Logout</a></li>
            </ul>
        </div>
    </nav>
    <nav id="nav-main" class="row full-width">
        <div class="inner">
            <a id="logo" href="/">
                <img src="/images/DevLogo_40k.png" />
            </a>

            <div id="menu-toggle" class="hide-for-large-up"></div>
            <div id="menu-wrap">
                <div class="hide-for-large-up"></div>
                <ul>
                    <li class="mainlink"><a href="/providers">Connectivity for Providers</a></li>
                    <li class="mainlink"><a href="/properties">Connectivity for Properties</a></li>
                    <li class="mainlink"><a href="/systems">Systems</a></li>
                    <li class="mainlink"><a href="/developer">Developer APIs</a></li>
                    <li class="mainlink"><a href="/blog">Blog</a></li>
                    <li class="mainlink"><a href="/contact-us">Contact Us</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<div class="full-width"><link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">
<script src="/js/jquery.DataTables.min.js"></script>
<script src="/js/dataTables.buttons.min.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="/js/foundation/foundation.reveal.js"></script>
<script src="/js/jwtAuthentication.js"></script>
<script src="/test-properties/urls.js"></script>
<style>
    .dataTables_length, .dataTables_filter {
        display: none;
    }

    .simple-content form {
        margin-top: 50px;
        margin-bottom: 200px;
    }

    .dataTables_paginate,.dataTables_info {
        display: none;
    }
</style>
<div class="large-6 large-centered medium-10 medium-centered columns simple-content">
    <h1>Test Property Assignment</h1>
    <hr/>
    <br/>
    <h2>Properties assigned to your account</h2>
    <p>Once you've scheduled a hotel, you can use it with our <a href="/developer" target="_blank">API's</a>, or view it in Expedia Partner Central to <a href="./info" target="_blank">find, view or cancel bookings.</a></p>
    <br/>
    <div id="account-dialogue" data-reveal class="tiny reveal-modal">
        <h1>Account Details</h1>
        <div></div>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>
    <div id="reset-dialogue" data-reveal class="tiny reveal-modal">
        <h1>Reset Password</h1>
        <div></div>
        <form id='reset'>
            <p>New Password:</p>
            <div class='formline'><input type='password' id='password' placeholder='8+ characters' required/></div>
            <div class='formline center error'></div><div class='formline'><input type='submit' value='Reset' class='submit'/></div>
        </form>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>
    <div id="extend-dialogue" data-reveal class="tiny reveal-modal">
        <h1>Cannot Extend</h1>
        <p>You may only extend a property schedule up to 2 weeks in the future. This is already the case for this property, please come back closer to the expiry date to extend it further.</p>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>
    <table id="hotels" class="display" cellspacing="0" width="100%"></table>
    <form id="requestHotelForm">
        <div id="result" class="formline center"></div>
        <hr/>
        <br/>
        <h2>Assign a test property to your account</h2>
        <div id="factors" class="row full-width"></div>
        <div class="row full-width request-hotel">
            <div class="large-6 columns">
                <label>Choose a password for your test API credentials</label>
                <input type="password" id="password" name="password" placeholder="8+ characters"/>
            </div>
            <div class="large-6 columns formline">
                <label>&nbsp;</label>
                <input class="submit" type="submit" value="Request Property"/>
            </div>
        </div>
        <div class="loader" style="display: none;">
            <div class="background">&nbsp;</div>
            <svg class="circular">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
            </svg>
        </div>
    </form>
</div>

<script>
    function loadStart() {
        $(".loader").show();
        $("#requestHotelForm input").attr("disabled", true).addClass("disabled");
    }

    function loadEnd() {
        $(".loader").hide();
        $("#result").removeClass("error");
        $("#requestHotelForm input").removeAttr("disabled").removeClass("disabled");
    }

    function loadStartButtons() {
        $(".loader").show();
        $("a.dt-button").each(function(i, el) {
            $(el).attr("data-href", $(el).attr("href")).removeAttr("href").addClass("disabled");
        });
    }

    function loadEndButtons() {
        $(".loader").hide();
        $("#result").removeClass("error");
        $("a.dt-button").each(function(i, el) {
            $(el).attr("href", $(el).attr("data-href")).removeAttr("data-href").removeClass("disabled");
        });
    }

    var datatable = false;
    var assignmentRequestFields = [];

    var columns = [
        { title: "Property ID" },
        { title: "Name" },
        { title: "Valid To", type: "date" },
        { title: "Model" },
        { title: "Currency" },
        { title: "Pricing" },
        { title: "RAT" },
        { title: "API Username" }
    ];

    var buttons = [
        { text: "Unassign", action: unassign },
        { text: "Extend", action: extend },
        { text: "Reset Password", action: resetPassword }
    ];

    $(document).ready(function() {
        datatable = $("#hotels").DataTable({
            dom: 'frtiB',
            columns: columns,
            buttons: buttons,
            pageLength: 100,
            ajax: function (data, callback, settings) {
                jwtRequest("GET", hotelAssignmentServiceUrls.schedule(), function(data, textStatus, jqxhr) {
                    console.log("Successful response for " + jqxhr.url + " : " + jqxhr.responseText);
                    if ($("#result").hasClass("error")) {
                        $("#result").removeClass("error").text("");
                    }
                    $(".dt-button").addClass("disabled").attr("title", "Select a property from the table first");
                    $(document).tooltip();
                    if (jqxhr.responseText == "") {
                        datatable.clear().draw();
                    } else {
                        callback({data: parseData(JSON.parse(jqxhr.responseText))});
                        datatable.order([ 2, "asc" ]).draw();
                    }
                }, function(jqxhr) {
                    ajaxError(jqxhr, "Could not lookup your scheduled test hotels.");
                    $(".dt-button").addClass("disabled").attr("title", "Select a property from the table first");
                    if (datatable && datatable.length == 0) {
                        datatable.clear().draw();
                    }
                });
            }
        }).on('click', 'tr', function() {
            if ($(this).hasClass("selected")) {
                $(this).removeClass("selected");
                $(".dt-button").addClass("disabled").attr("title", "Select a property from the table first");
                console.log("disabled");
            } else if (datatable && datatable.data().length != 0) {
                $("#hotels tr").removeClass("selected");
                $(this).addClass("selected");
                $(".dt-button").removeClass("disabled").removeAttr("title");
                console.log("enabled");
            }
        });

        $.getJSON(hotelAssignmentServiceUrls.factors(), parseFactors);
    });

    $('#requestHotelForm').submit(function (event) {
        event.preventDefault();
        autoAssignHotel();
    });

    function parseData(data) {
        var table = [];
        for (var i in data) {
            var tuid = data[i];
            for (var j in tuid.hotels) {
                var hotel = tuid.hotels[j];
                for (var k in hotel.dates) {
                    var date = hotel.dates[k];
                    table.push([hotel.hotelId, hotel.hotelName, date.endDate,
                                hotel.businessModel, hotel.currencyCode, hotel.pricingType, hotel.ratType, hotel.eqcAccountUsername]);
                }
            }
        }
        if (datatable.length == 0) {
            $(".dt-button").addClass("disabled").attr("title", "Select a property from the table first");
        }
        if (table.length == 0) {
            datatable.clear().draw();
        }
        return table;
    }

    function parseFactors(factors) {
        var factorsLoc = $('#factors');
        for (var i in factors) {
            var factor = factors[i];
            var label = $('<label>').text(factor.displayName);
            assignmentRequestFields.push(factor.factorName);
            var sel = $('<select>').attr("name", factor.factorName);
            sel.attr("id", "val_" + factor.factorName);
            sel.append($('<option>').prop("selected", true).attr('value', '').text('No preference'));
            for (var j in factor.validValues) {
                var value = factor.validValues[j];
                sel.append($('<option>').attr('value', value).text(value));
            }
            var elem = $("<div class='factor large-6 medium-12 columns'>").attr("id", factor.factorName).append(label).append(sel);
            factorsLoc.append(elem);
        }
    }

    function getNiceErrorText(jqxhr) {
        var content = jqxhr.getResponseHeader("Content-type");
        if (content.indexOf("json") >= 0) {
            var json;
            try {
                json = JSON.parse(jqxhr.responseText);
            } catch (e) {
                return jqxhr.responseText;
            }
            return json.details || json.message || json.description;
        } else if (content.indexOf("text/text")) {
            return jqxhr.responseText;
        }

        return false;
    }

    function ajaxError(jqxhr, humanError) {
        try {
            console.log("Error response for " + jqxhr.url + " : " + jqxhr.responseText);

            if (jqxhr) {
                var details = getNiceErrorText(jqxhr);
            }
        } catch (e) {
            console.log(humanError);
            console.log(jqxhr);
        }
        $("#result").addClass("error").html(humanError + (details ? "<br/>" + details : "")).effect( "highlight", {color:"#D62D20"}, 700 );
    }

    function addAssignmentField(request, fieldName) {
        var val = $('#val_' + fieldName).val();
        if (val != '') {
            request[fieldName] = val;
        }
    }

    function getAssignmentRequest() {
        var request = {};
        for (var i in assignmentRequestFields) {
            addAssignmentField(request, assignmentRequestFields[i]);
        }
        return JSON.stringify(request);
    }

    function jsonToUriVariables(json) {
        return Object.keys(json).map(function(key){
          return encodeURIComponent(key) + '=' + encodeURIComponent(json[key]);
        }).join('&');
    }

    function autoAssignHotel() {
        var password = $("#requestHotelForm #password").val();
        if (!password || password.length < 8) {
            $("#result").addClass("error").text("You must specify a password (8+ characters) to use for API calls.");
            return;
        }
        loadStart();
        var assignmentData = getAssignmentRequest();
        ga('send', 'event', 'assign', 'request', localStorage.getItem('username') + "|" + jsonToUriVariables(JSON.parse(assignmentData)));
        jwtRequestWithData("POST", hotelAssignmentServiceUrls.assign(), assignmentData, function(data, textStatus, jqxhr) {
            console.log("Successful response for " + jqxhr.url + " : " + jqxhr.responseText);
            var hotelId = JSON.parse(jqxhr.responseText).hotelId;
            datatable.ajax.reload(function() {
                $("#hotels>tbody>tr>td:first-child:contains(" + hotelId + ")").last().parent().children().effect( "highlight", {color:"#FECB2F"}, 700 );
            });
            jwtRequestWithData("POST", hotelAssignmentServiceUrls.setPassword(hotelId), JSON.stringify({ "password": password }), function(data, textStatus, jqxhr) {
                loadEnd();
                $("#result").html("Successfully assigned hotel: " + hotelId + ". <a href='./info' target='_blank'>What's Next?</a>").effect( "highlight", {color:"#FECB2F"}, 700 );
                console.log(data);
                $("#account-dialogue>div")
                        .empty()
                        .append($("<p/>").text("Test Hotel ID " + hotelId + " has been assigned to you.  To use it, please use these credentials in API calls:"))
                        .append($("<p/>").text("Username: " + data.eqcUsername))
                        .append($("<p/>").text("Password: [The one you set in the request.]"))
                        .parent()
                        .foundation('reveal', 'open');

                ga('send', 'event', 'assign', 'success', localStorage.getItem('username') + "|" + jsonToUriVariables(JSON.parse(assignmentData)));
            }, function(jqxhr) {
                loadEnd();
                ajaxError(jqxhr, "Successfully assigned hotel " + hotelId + " but could not set EQC password - please reset the password for the hotel manually.");
                ga('send', 'event', 'assign', 'password.failure', localStorage.getItem('username') + "|" + jqxhr.responseText);
            });
        }, function(jqxhr) {
            loadEnd();
            if (jqxhr.status == 409) {
                ajaxError(null, "No hotels to assign which match your preferences, please email <a href='mailto:eqcss" + "@expedia.com'>eqcss" + "@expedia.com</a>");;
            } else {
                ajaxError(jqxhr, "Could not schedule a test hotel.");
            }

            ga('send', 'event', 'assign', 'failure', localStorage.getItem('username') + "|" + jqxhr.responseText);
        });
    }

    function unassign(e, dt, node, config) {
        console.log("unassign");
        loadStartButtons();
        var hotelid = dt.cell(".selected", 0).data();
        ga('send', 'event', 'unassign', 'request', localStorage.getItem('username') + "|" + hotelid);
        jwtRequest("DELETE", hotelAssignmentServiceUrls.scheduleHotel(hotelid), function(data, textStatus, jqxhr) {
            console.log("Successful response for " + jqxhr.url + " : " + jqxhr.responseText);
            loadEndButtons();
            $("#result").text("Successfully unassigned hotel").effect( "highlight", {color:"#FECB2F"}, 700 );
            datatable.ajax.reload();
            ga('send', 'event', 'unassign', 'success', localStorage.getItem('username') + "|" + hotelid);
        }, function(jqxhr) {
            loadEndButtons();
            ajaxError(jqxhr, "Could not unassign a test hotel.");
            ga('send', 'event', 'unassign', 'failure', localStorage.getItem('username') + "|" + jqxhr.responseText, hotelid);
        });
    }

    function extend(e, dt, node, config) {
        console.log("extend");
        var hotelid = dt.cell(".selected", 0).data();
        var currentExpiryDate = new Date(dt.cell(".selected", 2).data()).getTime();
        var today = new Date();
        var newExpiryDate = Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate()) + 14 * 24*60*60*1000;
        if (currentExpiryDate >= newExpiryDate) {
            $("#extend-dialogue").foundation('reveal', 'open');
            return;
        }
        loadStartButtons();
        ga('send', 'event', 'extend', 'request', localStorage.getItem('username') + "|" + hotelid);
        jwtRequest("POST", hotelAssignmentServiceUrls.scheduleExtend(hotelid), function(data, textStatus, jqxhr) {
            console.log("Successful response for " + jqxhr.url + " : " + jqxhr.responseText);
            loadEndButtons();
            $("#result").text("Successfully extended hotel").effect( "highlight", {color:"#FECB2F"}, 700 );
            datatable.ajax.reload();
            ga('send', 'event', 'extend', 'success', localStorage.getItem('username') + "|" + hotelid);
        }, function(jqxhr) {
            loadEndButtons();
            ajaxError(jqxhr, "Could not extend a test hotel.");
            ga('send', 'event', 'extend', 'failure', localStorage.getItem('username') + "|" + jqxhr.responseText, hotelid);
        });
    }

    function resetPassword(e, dt, node, config) {
        var hotelid = dt.cell(".selected", 0).data();
        $("#reset-dialogue>div")
                .empty()
                .append($("<p/>").text("Reset the password of Test Hotel ID " + hotelid + "."))
                .parent()
                .foundation('reveal', 'open');
        $("#reset").submit(function() {
            console.log("reset");
            var password = $("#reset-dialogue #password").val();
            if (password.length < 8) {
                $("#reset-dialogue .error").text("8 character minimum");
                return false;
            }
            $("#reset-dialogue").foundation('reveal', 'close');
            loadStartButtons();
            ga('send', 'event', 'pwreset', 'request', localStorage.getItem('username'));
            jwtRequestWithData("POST", hotelAssignmentServiceUrls.setPassword(hotelid), JSON.stringify({ "password": password }), function(data, textStatus, jqxhr) {
                loadEndButtons();
                $("#result").text("Successfully reset password of hotel ID " + hotelid).effect( "highlight", {color:"#FECB2F"}, 700 );
                console.log(data);
                ga('send', 'event', 'pwreset', 'success', localStorage.getItem('username'));
            }, function(jqxhr) {
                loadEndButtons();
                ajaxError(jqxhr, "Could not reset password for hotel ID " + hotelid);
                ga('send', 'event', 'pwreset', 'failure', localStorage.getItem('username') + "|" + jqxhr.responseText);
            });
            return false;
        });
    }


</script>
</div><footer id="site-footer" class="row full-width">
    <div class="large-8 large-centered columns">
        <div class="links text-center">
            <a class="link-item" href="https://www.expediapartnercentral.com" target="_blank">Expedia PartnerCentral</a> |
            <a class="link-item" href="https://expediagso.secure.force.com/kb/pkb_Home?l=en_US" target="_blank">Knowledge Base</a> |
            <a class="link-item" href="/terms">Terms and Conditions</a> |
            <a class="link-item" href="/privacy">Privacy Policy</a> |
            <a class="link-item" href="/license">License Agreement</a>
        </div>
        <div class="show-for-large-up">
            <div class="footer-logo">&nbsp;</div>
        </div>
        <div id="footer-copyright">Â© 2016 Expedia, Inc. All rights reserved. Confidential and proprietary.</div>
    </div>
</footer>
<input type="hidden" id="eventTrackingPageName" value="Schedules"/></body></html>